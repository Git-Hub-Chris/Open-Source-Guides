<!DOCTYPE html>
<html lang="{{ page.lang }}">
  {% include head.html %}

<body>
  <main>
    <div id="content">
      <div id="results"></div>

      <!-- Main Content -->
      {{ content }}
    </div>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.usefathom.com/script.js" data-site="BFHXUQHJ" defer></script>
  <script src='{{ "/assets/js/index.js" | relative_url }}'></script>
  <script src="https://unpkg.com/lunr/lunr.js"></script>
  <script src='{{ "/assets/js/search.js" | relative_url }}'></script>
  
  <!-- Mailchimp Validation Script -->
  <script type="text/javascript" src="https://s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script>
  <script type="text/javascript">
    (function ($) {
      window.fnames = new Array(); 
      window.ftypes = new Array();
      fnames[0] = 'EMAIL'; ftypes[0] = 'email';
      fnames[1] = 'FNAME'; ftypes[1] = 'text';
      fnames[2] = 'LNAME'; ftypes[2] = 'text';
    }(jQuery)); 
    var $mcj = jQuery.noConflict(true);
  </script>

  <!-- Search Functionality -->
  <script>
    function searchSite(event) {
      event.preventDefault();
      const query = document.getElementById('searchBar').value.toLowerCase();
      const resultsContainer = document.getElementById('results');
      resultsContainer.innerHTML = ''; // Clear previous results
      
      if (!query) {
        return;
      }

      fetch('/assets/js/search-index.json')
        .then(response => response.json())
        .then(data => {
          const idx = lunr(function () {
            this.ref('id');
            this.field('title');
            this.field('content');

            data.forEach(doc => {
              this.add(doc);
            });
          });

          const results = idx.search(query);
          if (results.length === 0) {
            resultsContainer.innerHTML = '<p>No results found.</p>';
          } else {
            results.forEach(result => {
              const item = data.find(d => d.id === result.ref);
              const resultItem = `<h3>${item.title}</h3><p>${item.content.slice(0, 150)}...</p>`;
              resultsContainer.innerHTML += resultItem;
            });
          }
        });
    }
  </script>
</body>

</html>